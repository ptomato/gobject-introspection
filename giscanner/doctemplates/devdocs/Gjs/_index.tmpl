<%
  ancestors = []
  if isinstance(node, ast.Class):
    ancestors = formatter.get_inheritable_types(node)

  def get_ancestor_counts(*kinds):
    counts = {}
    for a in ancestors:
      count = sum([len(getattr(a, kind, [])) for kind in kinds])
      if count:
        counts[a] = count
    return counts

  def should_render(*kinds):
    has_nonempty = any([getattr(node, kind, []) for kind in kinds])
    return has_nonempty or get_ancestor_counts(*kinds)
%>

<%def name="inherited(*kinds)">
  <% counts = get_ancestor_counts(*kinds) %>
  % if counts:
    <%
      links = ', '.join(['{} ({})'.format(formatter.format_xref(a), count)
        for a, count in counts.items()])
    %>
    ${formatter.format(node, '**Inherited:** ' + links)}
  % endif
</%def>

% if should_render('static_methods', 'constructors', 'methods'):
  <h2 id="index-methods">Methods</h2>
  ${inherited('static_methods', 'constructors', 'methods')}
  <%
    static_methods = getattr(node, 'static_methods', []) + getattr(node, 'constructors', [])
    methods = static_methods + getattr(node, 'methods', [])
  %>
  % if methods:
    <table>
      <tbody>
      % for m in methods:
        <tr>
          % if m in static_methods:
            <td class="static-method-indicator">static</td>
          % else:
            <td></td>
          % endif
          <td>
            <a href="#${formatter.make_anchor(m)}">
              ${formatter.format_function_name(m)}<!-- no space
            --></a><!-- no space
            -->(${formatter.format_in_parameters(m)})
          </td>
        </tr>
      % endfor
      </tbody>
    </table>
  % endif
% endif

% if should_render('virtual_methods'):
  <h2 id="index-vfuncs">Virtual methods</h2>
  ${inherited('virtual_methods')}
  % if getattr(node, 'virtual_methods', []):
    <table>
      <tbody>
      % for m in node.virtual_methods:
        <tr>
          <td>
            <a href="#${formatter.make_anchor(m)}">
              ${formatter.format_function_name(m)}<!-- no space
            --></a><!-- no space
            -->(${formatter.format_in_parameters(m)})
          </td>
        </tr>
      % endfor
      </tbody>
    </table>
  % endif
% endif

% if should_render('properties'):
  <h2 id="index-properties">Properties</h2>
  ${inherited('properties')}
  % if getattr(node, 'properties', []):
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Flags</th>
        </tr>
      </thead>
      <tbody>
      % for p in node.properties:
        <tr>
          <td><a href="#${formatter.make_anchor(p)}">${p.name}</a></td>
          <td>${formatter.format_type(p.type)}</td>
          <td>${formatter.format_property_flags(p, abbrev=True)}</td>
        </tr>
      % endfor
      </tbody>
    </table>
  % endif
% endif

% if should_render('signals'):
  <h2 id="index-signals">Signals</h2>
  ${inherited('signals')}
  % if getattr(node, 'signals', []):
    <table>
      <tbody>
      % for s in node.signals:
        <tr>
          <td>
            <a href="#${formatter.make_anchor(s)}">${s.name}</a><!-- no space
            -->(${formatter.format_in_parameters(s)})
          </td>
        </tr>
      % endfor
      </tbody>
    </table>
  % endif
% endif

% if should_render('fields'):
  <h2 id="index-fields">Fields</h2>
  ${inherited('fields')}
  % if getattr(node, 'fields', []):
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Access</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
      % for f in node.fields:
        <tr>
          <td><span class="entry" href="#${formatter.make_anchor(f)}">${f.name}</span></td>
          <td>${formatter.format_type(f.type)}</td>
          <td>${formatter.format_property_flags(f, abbrev=True)}</td>
          ## Fields almost never warrant a detailed entry, we'll just make this
          ## the entry to be indexed by DevDocs
          <td>
          % if f.doc:
            ${formatter.format_inline(node, f.doc)}
          % endif
          </td>
        </tr>
      % endfor
      </tbody>
    </table>
  % endif
% endif
